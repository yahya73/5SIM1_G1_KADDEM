pipeline {
    agent any
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }

        stage('Git') {
            steps {
                git branch: 'salim', changelog: false, poll: false, url: 'https://github.com/yahya73/KADDEM_DEVOPS.git'
            }
        }
        stage('Testing Maven') {
                    steps {
                        sh 'mvn -version'
                    }
        }


             stage('Build') {
                 steps {
                     sh 'mvn clean install -DskipITs'
                 }
             }
              stage('Display Date') {
                         steps {
                             script {
                                 def currentDate = new Date()
                                 echo "Current Date: ${currentDate}"
                             }
                         }
                }
              stage('Mockito') {
                     steps {
                     echo 'Running Maven tests...'
                        sh 'mvn test'
                     }
                    }

             stage ('SonarQube') {

                                 steps {

                                     sh 'mvn sonar:sonar -Dsonar.token=squ_eb520a8a5badd7b20b96263dd6648bf681aab8a4  -Dmaven.test.skip=true';

                                 }

                             }
                             stage ('Nexus') {
                                 steps {
                                     sh 'mvn clean deploy -DskipTests -Dusername=admin -Dpassword=nexus'
                                       }
                             }
                             stage ('dockercompose') {
                                 steps {
                                       sh 'docker compose down '
                                       sh 'docker compose up -d'
                                                  }
                                 }
                              stage('Use Existing Grafana Dashboard') {
                                         steps {
                                        ${GRAFANA_URL}/d/haryan-jenkins/jenkins3a-performance-and-health-overview"
                                              }
                                         }



    }




}